#!/bin/bash

# AAStar SDK pre-commit hook
# Runs the local security scan and fast tests before allowing a commit.

# Robust PATH setup
export PATH="$PATH:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:/opt/homebrew/bin:$HOME/.foundry/bin"

echo "üîç Running pre-commit security & test checks..."

# 1. Run Security Scan
npx tsx scripts/security-scan.ts
if [ $? -ne 0 ]; then
    echo "‚ùå Security check failed! Commit metadata or private keys found."
    exit 1
fi

# 2. Run Fast Tests (Optional but recommended)
# pnpm run test:fast
# if [ $? -ne 0 ]; then
#     echo "‚ùå Fast tests failed! Please fix before committing."
#     exit 1
# fi

echo "‚úÖ Pre-commit check passed."
exit 0
